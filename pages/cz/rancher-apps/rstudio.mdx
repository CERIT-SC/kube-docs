# RStudio

## Spuštění RStudia
Nabízíme dva způsoby, jak spustit RStudio:

1. Spusťte RStudio ve webovém JupyterHubu - tato možnost ❗️**vyžaduje platný účet MetaCentrum**❗️. JupyterHub poskytuje jednoduchý způsob, jak vytvořit RStudio a přímočarou integraci s domovskou stránkou MetaCentrum. Podporována je pouze verze R 4.2.1.

2. Spusťte RStudio jako aplikaci Rancher - tato možnost je ❗️**pro každého, kdo nemá účet MetaCentrum**❗️. Nabízí více verzí R, ale je o něco složitější na nastavení.

## JupyterHub RStudio
JupyterHub je webová aplikace, která má jednoduchý vstupní formulář, kde si vybíráte různé nastavení nasazení. Chcete-li se dozvědět více, podívejte se na [úvod do JupyterHubu](../webapps/jupyterhub), kde najdete další potřebné informace.

## Rancher RStudio
Pokud nejste již přihlášeni, přihlaste se na [rancher.cloud.e-infra.cz](https://rancher.cloud.e-infra.cz), viz sekce [Rancher](../rancher/rancher).

Následujícími kroky můžete nainstalovat webovou aplikaci RStudio. Tato aplikace má trvalý domovský adresář, což znamená, že pokud aplikaci odstraníte a později ji znovu nainstalujete se stejným názvem, obsah domovského adresáře bude zachován.

### Poznámky

* Výchozí projekt má limit kvóty pro 12 garantovaných CPU a limit kvóty pro 16 CPU. Nevybírejte více než 10 garantovaných CPU a více než 14 CPU limit. Pokud potřebujete více, stačí [se zeptat](mailto:k8s@ics.muni.cz). Toto může být v budoucnu zvýšeno, takže lze požádat o více CPU.

### Výběr aplikace k spuštění

Procházejte `Only User Namespaces` (1), `App & Marketplace` (2), `Charts` (3), `cerit-sc` (4) a vyberte `RStudio` (5). Viz snímek obrazovky níže.

![selectapp](/img/ceritsc/apps/rstudio/selectapp.png)

### Instalace aplikace

Když kliknete na graf, stiskněte `Install`, abyste pokračovali.

![selectapp](/img/ceritsc/apps/rstudio/selectversion.png)

Nyní můžete nainstalovat aplikaci RStudio. Většinou si ponechte jak `Namespace` (1), tak `Name` (2) beze změny, nicméně můžete vybrat namespace podle potřeby kromě `default`. Namespace `default` je k dispozici, ale není určen k použití. `Name` bude v URL pro přístup k aplikaci. `Name` musí být jedinečné v rámci `Namespace`, tj. nemůžete spustit dvě nebo více instancí se stejným `Name` ve stejném `Namespace`. Pokud aplikaci odstraníte a později ji znovu nainstalujete se stejným `Name`, obsah domovského adresáře bude zachován.

![appinst](/img/ceritsc/apps/rstudio/appinst.png)

V první části formuláře si vyberete R image, pomocí kterého vyberete verzi R. Image s tagem `Full` obsahuje většinu systémových knihoven a také umožňuje instalaci dalších systémových balíčků pomocí příkazu `fakeroot`, jako je `fakeroot apt-get install libssl-dev`. Nicméně, pokud je aplikace restartována nebo přeinstalována, všechny instalace provedené pomocí `fakeroot` jsou ztraceny a musí být nainstalovány znovu.

![appinst](/img/ceritsc/apps/rstudio/appform1.png)

Ve druhé části formuláře si vyberete přístupové heslo, prosím, vyhněte se znakům jako `{`, `}`, doporučuje se silné heslo, nicméně se také důrazně doporučuje nepoužívat heslo, které již používáte jinde. Uživatelské jméno bude pouze **`rstudio`**.

![appform1](/img/ceritsc/apps/rstudio/appform2.png)

Ve třetí části formuláře si můžete vybrat **e-infra** úložiště (3) pro připojení k aplikaci. Pokud zaškrtnete `External Storage`, je podporováno pouze `storage-brno12-cerit.metacentrum.cz`. Pokud chcete toto úložiště připojit, postupujte podle [návodu na vytvoření úložiště](../other/storagesecrets). Na [stránce úložných tajemství](storagesecrets.cloud.e-infra.cz) kliknete na první možnost `Create Samba password for storage-brno12-cerit.metacentrum.cz`. Toto úložiště je připojeno k adresáři `/home/rstudio/data`.

Můžete také vybrat trvalý objem `/opt` (2), který se používá pro nainstalované balíčky prostřednictvím instalátoru `conda`, viz níže. Trvalý `/opt` uchovává nainstalované balíčky i po restartu `rstudio`.

Trvalý `home` (1) umožňuje uchovat obsah domovského adresáře i po restartu `rstudio`.

![appinst](/img/ceritsc/apps/rstudio/appform3.png)

Ve čtvrté části formuláře si můžete vybrat požadované zdroje. Tento krok je volitelný. `Minimum` CPU nebo RAM je garantované množství CPU a RAM, systém si tyto zdroje pro aplikaci rezervuje. Nicméně, aplikace může překročit garantované zdroje až do `Maximum`. V tomto případě však nejsou zdroje exkluzivní a mohou být sdíleny mezi jinými aplikacemi. Pokud aplikace překročí `Maximum` CPU, bude omezena, pokud překročí `Maximum` RAM, bude ukončena (uvidíte zprávu OOMKill) a restartována. Viz poznámka výše o maximálních hodnotách.

![appform2](/img/ceritsc/apps/rstudio/appform4.png)

### Počkejte na spuštění aplikace

Když stisknete `Install`, uvidíte instalační protokol. Jakmile uvidíte `SUCCESS` (viz snímek obrazovky níže), aplikace běží.

![apphelm](/img/ceritsc/apps/rstudio/apphelm.png)

### Přihlášení do běžící instance

Jakmile aplikace běží, procházejte `Service Discovery` (1) a `Ingresses` (2). Uvidíte `Ingresses`. Pokud uvidíte `cm-acme-http-solver...` (3), počkejte, až zmizí. Jakmile uvidíte `rstudio` nebo jakýkoli `Name`, který jste použili v předchozích krocích, můžete kliknout na Cíl (4) pro přihlášení do aplikace.


![appacme](/img/ceritsc/apps/rstudio/appacme.png)

Uvidíte přihlašovací okno, použijte **`rstudio`** jako uživatelské jméno a vybrané heslo z formuláře.

![applogin](/img/ceritsc/apps/rstudio/applogin.png)

## Smazat běžící instanci

Pokud máte pocit, že aplikaci již nepotřebujete, můžete ji smazat. Stačí přejít na `App & Marketplace` (1), `Installed Apps` (2), vybrat aplikaci (3) a kliknout na `Delete` (4). Data v domovském adresáři nejsou smazána. Opětovným spuštěním aplikace se stejným `Name` se obnoví přístup k adresáři domovské složky.

![appdel](/img/ceritsc/apps/rstudio/appdel.png)

## Nainstalovat další balíčky

Od verze grafu **1.4** je možné použít nástroj `conda` nebo `mamba` k instalaci dalších balíčků. Tyto balíčky jsou instalovány do adresáře `/opt/conda`. Např. v `rstudio` `terminálu` (1) zadejte: `mamba install mc` (3) pro instalaci balíčku `mc`. Pokud vidíte `(base)` (2) na začátku výzvy, všechny cesty jsou nastaveny správně pro použití balíčků nainstalovaných pomocí `conda`. Pokud `(base)` nevidíte, zadejte: `/opt/conda/bin/conda init`, zavřete `terminál` a spusťte nový. Tato akce je vyžadována pouze jednou.

![terminal](/img/ceritsc/apps/rstudio/terminal.png)
