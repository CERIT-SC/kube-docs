# Matlab

## Spuštění Matlabu

Pokud nejste přihlášeni, přihlaste se na [rancher.cloud.e-infra.cz](https://rancher.cloud.e-infra.cz), viz sekce [Rancher](../rancher/rancher).

Následujícími kroky můžete spustit aplikaci Matlab. Tato aplikace má trvalý domovský adresář, což znamená, že pokud aplikaci odstraníte a později ji znovu nainstalujete se stejným názvem, obsah domovského adresáře bude zachován. Je také možné připojit nějaké úložiště z e-infra.

### Poznámky

* Výchozí projekt měl kvótový limit pro 12 garantovaných CPU a kvótu pro limit 16 CPU. Nevybírejte více než 10 garantovaných CPU a více než 14 CPU limit. Pokud potřebujete více, jednoduše [se zeptejte](mailto:k8s@ics.muni.cz). Toto může být v budoucnu zvýšeno, takže žádost o více CPU může být podána.

* Pokud v kroku **Nainstalovat aplikaci** nevyberete `Přizpůsobit možnosti Helm před instalací`, instalace se zdá, že selhala, ale ve skutečnosti funguje po delší době.

* Od verze Matlab `v9.11.1` je možné připojit váš domovský adresář MetaCentrum bez žádosti o heslo. Je však nutné vytvořit sadu specifických objektů Kubernetes. Celý proces jsme zjednodušili a stačí, když: 
  *  Nejprve projdete [tímto krátkým tutoriálem](../other/storagesecrets), kde se pouze přihlásíte do našeho vlastního servisu a vyberete prostor, kde vytvořit objekty
  *  Za druhé, spusťte aplikaci Matlab z Rancheru stejným způsobem jako dříve, pouze vyberte verzi **v9.11.1** a vyšší. Formulář aplikace obsahuje pole v sekci `Úložiště`, kde vyberete svůj domov.

![selectapp](/img/ceritsc/apps/matlab/matlab-home.png)

### Vyberte aplikaci k spuštění

Ujistěte se, že jste nevybrali žádný prostor a vidíte `Pouze uživatelské prostory` (1) v horní části stránky Rancher.

Procházejte `Aplikace & Trh` (2), `Grafy` (3), omezte grafy pouze na `cerit-sc` (4) a vyberte `Matlab` (5). Viz snímek obrazovky níže.

![selectapp](/img/ceritsc/apps/matlab/selectapp.png)

### Vyberte verzi aplikace

Když kliknete na graf, můžete vybrat verzi aplikace, jak je znázorněno níže. Vyberte `Verzi grafu`, přesnou verzi Matlabu najdete pod `Verze aplikace`. Verze se mohou v průběhu času lišit. Klikněte na `Nainstalovat`, abyste pokračovali.

![selectversion](/img/ceritsc/apps/matlab/selectversion.png)

### Nainstalujte aplikaci

Nyní můžete nainstalovat aplikaci Matlab. Většinou ponechte jak `Prostor` (1), tak `Název` (2) nedotčené, ale vyberte `Přizpůsobit možnosti Helm před instalací` (3), nicméně můžete vybrat prostor podle potřeby kromě `default`. Prostor `default` je k dispozici, ale není určen k použití. `Název` bude v URL pro přístup k aplikaci. `Název` musí být jedinečný v `Prostoru`, tj. nemůžete spustit dvě nebo více instancí se stejným `Názvem` ve stejném `Prostoru`. Pokud aplikaci odstraníte a později ji znovu nainstalujete se stejným `Názvem`, obsah domovského adresáře bude zachován.

![appinst](/img/ceritsc/apps/matlab/appinst.png)

V první části formuláře vyberete metodu zobrazení přístupu. [VNC]((https://cs.wikipedia.org/wiki/Virtual_Network_Computing) metoda je výchozí. Budete potřebovat nějaký program vncview [realvnc](https://www.realvnc.com/en/connect/download/viewer/) nebo `vncviewer` na většině distribucí Linuxu. Na MacOS stačí napsat `vnc://host` do prohlížeče Safari, nahraďte `host` podle pokynů níže. Než kliknete na `Nainstalovat`, ujistěte se, že je formulář dokončen. Při použití *VNC* je k dispozici pouze softwarové vykreslování, 3D akcelerace není možná.

Pokud není vybráno VNC, používá se metoda *WEBRTC*. Tato možnost je stále v beta verzi a není připravena pro produkční použití, nicméně je k dispozici plná 3D OpenGL akcelerace.

![appform1](/img/ceritsc/apps/matlab/appform1.png)

Ve druhé části formuláře vyberete `heslo`. Toto heslo se používá k přihlášení přes VNC. Pokud VNC není vybráno, musíte také vyplnit `uživatelské jméno`, tyto přihlašovací údaje budou použity v prohlížeči k připojení k relaci *WEBRTC*.

![appform2](/img/ceritsc/apps/matlab/appform2.png)

Ve třetí části formuláře vyberete, zda si přejete trvalý domov, tj. domov, který bude zachován i po odinstalaci aplikace. Poznámka: trvalý domov je spojen s názvem aplikace od samého začátku formuláře pro instalaci. To znamená, že pokud nastavíte název na `matlab`, trvalý domov bude spojen s názvem `matlab`. Pokud příště vyberete název `matlab-0`, získáte nový domov, který je spojen s názvem `matlab-0`.

V této části můžete vybrat úložiště **e-infra**, které se připojí k aplikaci. Pokud zaškrtnete `Externí úložiště`, objeví se několik dalších možností. Můžete vybrat úložiště a přihlašovací údaje. V současnosti je podporováno pouze `storage-brno12-cerit.metacentrum.cz`. Uživatelské jméno je přihlášení e-infra ([metacentrum](https://metavo.metacentrum.cz/)) a heslo **není** heslo Metacentrum, ale jiné nastavené administrátorem, [zeptejte se](mailto:k8s@ics.muni.cz), pokud potřebujete nastavit. Připravujeme pohodlnější způsob. Toto úložiště je připojeno k adresáři `/storage`.

![appform3](/img/ceritsc/apps/matlab/appform3.png)


Ve čtvrté části formuláře můžete vybrat požadované zdroje. Tento krok je volitelný. `Minimální` CPU nebo RAM je garantované množství CPU a RAM, systém si tyto zdroje rezervuje pro aplikaci. Aplikace však může překročit garantované zdroje až do `Maximální`. V tomto případě však nejsou zdroje exkluzivní a mohou být sdíleny mezi dalšími aplikacemi. Pokud aplikace překročí `Maximální` CPU, bude omezena, pokud překročí `Maximální` RAM, bude ukončena (uvidíte zprávu OOMKill) a restartována. Viz poznámka výše o maximálních hodnotách.

![appform4](/img/ceritsc/apps/matlab/appform4.png)

V páté části formuláře vyberte časový limit 1200 sekund, což je způsobeno opravdu velkými Matlab obrazy. Nakonec klikněte na `Instalovat`.

![appform5](/img/ceritsc/apps/matlab/appform5.png)

### Počkejte na spuštění aplikace

Když kliknete na `Instalovat`, uvidíte instalační protokol. Jakmile uvidíte `ÚSPĚCH` (viz screenshot níže), aplikace běží.

#### Poznámky

* Může trvat nějakou dobu, než bude aplikace připravena, protože stahuje 20GB docker kontejner, pokud již není v cache, první spuštění může trvat až 20 minut.
* Pokud zadané heslo nebylo správné, bude čekat neomezeně dlouho. V takovém případě aplikaci odstraňte a začněte znovu.

![apphelm](/img/ceritsc/apps/matlab/apphelm.png)

### Připojte se k běžící instanci

Jakmile aplikace běží, pro *VNC* verzi přejděte na `Service Discovery` (1) a `Services` (2), najeďte myší na `Target` (3) a v závislosti na použitém prohlížeči byste měli vidět cílovou URL (4). Prohlížeč Chrome to zobrazuje v dolním levém rohu. Toto je IP adresa a port, které potřebujete předat své aplikaci `vncviewer` nebo vyplnit do navigačního panelu Safari, např. `vnc://147.251.253.246`.

V případě *WEBRTC* místo `Services` přejděte na `Ingresses` (5) a uvidíte plnou URL, na kterou můžete kliknout pro zahájení *WEBRTC* připojení.

*VNC* klient se zeptá na heslo. Zadejte heslo z formuláře. *WEBRTC* připojení se zeptá na uživatelské jméno a heslo, ty **nejsou** uživatelským jménem a heslem metacentra, ale těmi, které jsou na začátku formuláře.

![apphelm](/img/ceritsc/apps/matlab/appservice.png)

## Matlab

Při prvním přihlášení bude pracovní plocha vypadat takto:
![app](/img/ceritsc/apps/matlab/app.png)

Vidíte `licenční kontroler`, který slouží k ověření dostupných licencí Matlab. Můžete vybrat, které licence chcete použít. Pokud nejsou k dispozici žádné volné licence, bude kontrolovat periodicky a jakmile bude licence volná, spustí se plynule. Alternativně můžete spustit jinou část Matlabu pomocí ikon na pracovní ploše nebo pomocí terminálu.

Jelikož je Matlab licencovaný produkt, musíte souhlasit s tím, že tento produkt používáte pouze pro akademické účely a že máte nárok na používání licence, tj. jste uživatel nebo student MetaCentra nebo zaměstnanec Masarykovy univerzity v Brně, Západočeské univerzity v Plzni nebo Českého vysokého učení technického v Praze.

![legal](/img/ceritsc/apps/matlab/matlab-legal.png)

## Odstranit běžící instanci

Pokud máte pocit, že aplikaci již nepotřebujete, můžete ji odstranit. Stačí přejít na `App & Marketplace` (1), `Installed Apps` (2), vybrat aplikaci (3) a kliknout na `Odstranit` (4). Data v domovském adresáři nejsou odstraněna, pokud zaškrtnete trvalý domov. Opětovným spuštěním aplikace se stejným `Název` obnoví přístup k adresáři domovské složky.

![appdel](/img/ceritsc/apps/matlab/appdel.png)
