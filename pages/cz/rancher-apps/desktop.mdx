# Desktop

## Spuštění Desktopu

Pokud nejste již přihlášeni, přihlaste se na [rancher.cloud.e-infra.cz](https://rancher.cloud.e-infra.cz), viz sekce [Rancher](../rancher/rancher).

Můžete spustit desktopovou aplikaci podle níže uvedených kroků. Tato aplikace může mít trvalý domovský adresář, což znamená, že pokud aplikaci odstraníte a později ji znovu nainstalujete pod stejným názvem, obsah domovského adresáře bude zachován. Je také možné připojit nějaké úložiště z e-infra.

### Poznámky

* Výchozí projekt měl kvótový limit pro 12 garantovaných CPU a kvótový limit pro 16 CPU. Nevybírejte více než 10 garantovaných CPU a více než 14 CPU limit. Pokud potřebujete více, jednoduše [se zeptejte](mailto:k8s@ics.muni.cz). To může být v budoucnu zvýšeno, takže se můžete ptát na více CPU.

### Výběr aplikace k spuštění

Ujistěte se, že jste nevybrali žádný namespace a vidíte `User Namespaces Only` (1) v horní části stránky Rancher.

Procházejte `App & Marketplace` (2), `Charts` (3), omezte grafy pouze na `cerit-sc` (4) a vyberte `desktop` (5). Viz screenshot níže.

![selectapp](/img/ceritsc/apps/desktop/selectapp.png)

### Výběr verze aplikace

Když kliknete na graf, můžete vybrat verzi aplikace, jak je znázorněno níže. Verze grafů se mohou v průběhu času měnit. Stiskněte `Install` pro pokračování.

![selectversion](/img/ceritsc/apps/desktop/selectversion.png)

### Instalace aplikace

Nyní jste připraveni nainstalovat desktopovou aplikaci. Většinou necháte jak `Namespace` (1), tak `Name` (2) tak, jak jsou, ale můžete si vybrat jakýkoli namespace kromě `default`. Namespace `default` je k dispozici, ale není určen k použití. `Name` bude v URL pro přístup k aplikaci. `Name` musí být jedinečné v rámci `Namespace`, tj. nemůžete spustit dvě nebo více instancí se stejným `Name` ve stejném `Namespace`. Pokud aplikaci odstraníte a později ji znovu nainstalujete pomocí stejného `Name`, obsah domovského adresáře bude zachován, pokud je to povoleno.

![appinst](/img/ceritsc/apps/desktop/appinst.png)

V první části formuláře vyberete `Desktop` `Image`, v současnosti jsou k dispozici LTS Ubuntu 18, 20, 22, ale obrazy se mohou v průběhu času měnit.

![appform1](/img/ceritsc/apps/desktop/appform1.png)

Ve druhé části formuláře vyberte zobrazovací protokol. Výchozí je [VNC]((https://cs.wikipedia.org/wiki/Virtual_Network_Computing)). Budete potřebovat program vncview [realvnc](https://www.realvnc.com/en/connect/download/viewer/) nebo `vncviewer` na většině distribucí Linuxu. Na MacOS stačí napsat `vnc://host` v prohlížeči Safari, přičemž `host` nahraďte podle pokynů níže. Nemačkejte `Install`, dokud nebude formulář kompletní. Při použití *VNC* je k dispozici pouze softwarové vykreslování, 3D akcelerace není možná.

Pokud není vybráno VNC, bude použita metoda *WEBRTC*. Tato možnost je stále v beta verzi, ale plná 3D OpenGL akcelerace je k dispozici.

#### Poznámka

*WEBRTC* metoda je k dispozici v prohlížečích založených na Chromiu, jako jsou `Google Chrome`, Microsoft Edge; nebo v Apple Safari. Je důležité poznamenat, že nefunguje v Mozilla Firefox.

![appform2](/img/ceritsc/apps/desktop/appform2.png)

Ve třetí části formuláře vyberete `password`. Toto heslo se používá pro přihlášení k VNC. Pokud není vybráno VNC, musíte také vyplnit `username`, tyto přihlašovací údaje budou použity v prohlížeči pro připojení k *WEBRTC* relaci.

#### Pro VNC
![appform3](/img/ceritsc/apps/desktop/appform3.png)

#### Pro WEBRTC
![appform3-rtc](/img/ceritsc/apps/desktop/appform3-rtc.png)

Ve čtvrté části formuláře vyberete, zda chcete trvalý domov, tj. domov, který bude zachován i po odinstalaci aplikace. Poznámka: trvalý domov je vázán na název aplikace od samého začátku instalačního formuláře. To znamená, že pokud nastavíte název na `desktop`, trvalý domov bude vázán na název `desktop`. Pokud příště vyberete název `desktop-0`, dostanete nový domov vázaný na název `desktop-0`.

V této části můžete vybrat **e-infra** úložiště, které se připojí k aplikaci. Pokud zaškrtnete `External Storage`, objeví se další možnosti. Můžete vybrat úložiště a přihlašovací údaje. V současnosti je podporováno pouze `storage-brno12-cerit.metacentrum.cz`. Uživatelské jméno je e-infra ([metacentrum](https://metavo.metacentrum.cz/)) přihlášení a heslo **není** heslo metacentra, ale jiné nastavené administrátorem, [zeptejte se](mailto:k8s@ics.muni.cz), pokud potřebujete nastavit. Připravujeme pohodlnější způsob. Toto úložiště bude připojeno k adresáři `/storage`.

![appform3](/img/ceritsc/apps/desktop/appform4.png)

V páté části formuláře můžete vybrat požadované zdroje. Tento krok je volitelný. Minimální CPU nebo RAM je garantované množství CPU a RAM, systém si tyto zdroje pro aplikaci rezervuje. Aplikace však může překročit garantované zdroje až do `Maximum`. V tomto případě nejsou zdroje výhradní a mohou být sdíleny s jinými aplikacemi. Pokud aplikace překročí `Maximum` CPU, bude omezena, pokud překročí `Maximum` RAM, bude ukončena (uvidíte zprávu OOMKill) a restartována. Viz poznámka výše o maximálních hodnotách.


![appform4](/img/ceritsc/apps/desktop/appform5.png)

### Počkejte, až se aplikace spustí

Když stisknete `Install`, uvidíte instalační protokol. Když uvidíte `SUCCESS` (1) (viz screenshot níže), aplikace běží. V případě verze `VNC` uvidíte URL, kterou byste měli předat prohlížeči VNC (2) nebo v případě verze WebRTC prohlížeči (2).

#### Poznámky

* Pokud zadané heslo pro úložiště nebylo správné, bude čekat na dokončení neomezeně. V tomto případě aplikaci odstraňte a začněte znovu.

#### VNC

![apphelm](/img/ceritsc/apps/desktop/apphelm.png)

#### WebRTC

![apphelm](/img/ceritsc/apps/desktop/apphelm-rtc.png)

### Připojte se k běžící instanci

Jakmile aplikace běží, pro verzi *VNC* přejděte na `Service Discovery` (1) a `Services` (2), najeďte myší na `Target` (3) a v závislosti na použitém prohlížeči byste měli vidět cílovou URL (4). Prohlížeč Chrome ji zobrazuje v levém dolním rohu. Toto je IP adresa a port, které potřebujete předat své aplikaci `vncviewer` nebo vyplnit do adresního řádku Safari, např. `vnc://147.251.253.246`. Nebo jednoduše použijte URL prohlížeče z výše uvedených screenshotů.

V případě *WEBRTC* místo `Services` přejděte na `Ingresses` (5) a uvidíte plnou URL, na kterou můžete kliknout pro zahájení *WEBRTC* připojení.

Klient *VNC* se zeptá na heslo. Zadejte heslo z formuláře. Připojení *WEBRTC* se zeptá na uživatelské jméno a heslo, tyto **nejsou** uživatelské jméno a heslo metacentra, ale ty, které byly na začátku formuláře.

![apphelm](/img/ceritsc/apps/desktop/appservice.png)

## Desktop

Při prvním přihlášení bude desktop vypadat takto, v závislosti na zvolené verzi:

![appdesktop](/img/ceritsc/apps/desktop/ubuntu18.png)

## Odstranění běžící instance

Pokud máte pocit, že aplikaci již nepotřebujete, můžete ji odstranit. Stačí přejít na `Apps & Marketplace` (1), `Installed Applications` (2), vybrat aplikaci (3) a stisknout `Delete` (4). Data v domovském adresáři nebudou smazána, pokud zvolíte trvalý domov. Opětovné spuštění aplikace se stejným názvem obnoví přístup k domovské složce.

![appdel](/img/ceritsc/apps/desktop/appdel.png)

## Instalace dalšího softwaru

Je možné nainstalovat další software do běžícího desktopu pomocí systémové instalace nebo systému `conda`.

### Systémová instalace

Příkazy `apt-get install`, `apt install` nebo `dpkg -i` lze použít k instalaci jakéhokoli balíčku do běžícího desktopu. Pokud však dojde k restartování desktopu, všechny nainstalované balíčky se ztratí a musí být znovu nainstalovány. Všechny zmíněné příkazy jsou aliasy shellu používající `fakeroot` a tyto aliasy fungují pouze v `bash`, pokud používáte jiný shell, možná budete muset použít např.: `fakeroot apt-get install [balíček]`.

### Conda

Doporučujeme používat nástroj `mamba` místo `conda`, protože je rychlejší. Pokud si nastavíte virtuální conda prostředí ve svém domovském adresáři, vše nainstalované pomocí `conda` nebo `mamba` bude trvalé. Pro více informací si přečtěte oficiální dokumentaci conda (https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#managing-environments), zejména `Specifying a location for an environment`.
