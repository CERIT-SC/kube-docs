# Samba Server

## Samba Server
Samba server může být použit k vystavení Persistent Volume Claim prostřednictvím protokolu CIFS/SMB jako síťový disk dostupný na specifikované **URL** ve formátu `\\[namespace]-[samba_name].dyn.cloud.e-infra.cz\data`. Persistent Volume Claim (PVC) se používá jako úložiště pro běžící aplikace v Kubernetes. Pokud chcete nahrávat/stahovat data do/z PVC pomocí GUI, Samba server je pohodlný způsob, jak to udělat.

### Požadavky
Samba server funguje pouze tehdy, když chcete vystavit již existující PVC! Ujistěte se tedy, že vaše PVC již existuje.

### Instalace
1. V GUI Rancher zkontrolujte název PVC, které chcete vystavit. V příkladu budeme vystavovat PVC s názvem `matlab-home` v namespace `spisakova-ns`.

![pvcs](/img/ceritsc/apps/samba-images/pvc.png) 

2. Přejděte na všechny dostupné aplikace a vyberte `samba`, poté klikněte na tlačítko instalace v pravém horním rohu.

![samba](/img/ceritsc/apps/samba-images/charts.png) 

3. Vyberte namespace, do kterého bude aplikace nasazena. Musíte zvolit **stejný** namespace jako namespace PVC, které chcete vystavit. V příkladu tedy vybíráme namespace `spisakova-ns`. Zvolte název pro vaši samba aplikaci, který bude součástí konečné URL; název musí být v namespace jedinečný. V příkladu použijeme `samba-matlab`.

![samba-basic](/img/ceritsc/apps/samba-images/basic.png) 

4. V nastavení serveru nastavte heslo pro samba server. Vyberte PVC, které chcete vystavit, v příkladu vybíráme `matlab-home`.

![samba-server-settings](/img/ceritsc/apps/samba-images/serversettings.png)

4.1. Váš síťový disk bude dostupný pouze v síti MUNI nebo po připojení k MUNI VPN. Pokud chcete přistupovat k síťovému disku z jiného místa, vyberte veřejné vystavení na druhé záložce `Expose type`. 

![samba-public-expose](/img/ceritsc/apps/samba-images/expose.png)

5. Počkejte, až bude samba server nainstalován, mělo by to trvat několik sekund. 

### Připojení
Konečné URL se skládá z vybraného namespace a názvu samba aplikace. V našem případě vidíme název (samba-matlab) a namespace (spisakova-ns) vedle zeleného `Deployed` (což je známka úspěšné instalace spolu se zprávou SUCCESS v logovacím okně na spodní části stránky). Konečné URL je tedy `spisakova-ns-samba-matlab.dyn.cloud.e-infra.cz`.  **Uživatelské jméno je vždy user, heslo je to, které jste zvolili při nastavování aplikace.** 

1. Linux --- Nejprve nainstalujte `cifs-utils` na Ubuntu/Debian OS. Po instalaci zadejte příkaz `mount.cifs //[namespace]-[samba_name].dyn.cloud.e-infra.cz\data [mount_location] -o username=user`. Zadejte heslo. Poté můžete změnit adresář na místo zvolené jako mountpoint a pracovat se síťovým diskem jako s běžným adresářem. 

![samba-linux-command](/img/ceritsc/apps/samba-images/linux-command.png)

2. Windows --- Otevřete Průzkumníka souborů z hlavního panelu nebo nabídky Start, nebo stiskněte klávesu s logem Windows + E. Vyberte Tento počítač z levého panelu. Poté na kartě Počítač vyberte Mapovat síťovou jednotku. Do pole Složka zadejte cestu k složce nebo počítači `\\[namespace]-[samba_name].dyn.cloud.e-infra.cz\data`. Vyberte přihlášení jako `jiný účet` a zadejte přihlašovací údaje. 

![samba-windows-choose](/img/ceritsc/apps/samba-images/windows-choose.png)

![samba-windows-server](/img/ceritsc/apps/samba-images/windows-server.png)

![samba-windows-login](/img/ceritsc/apps/samba-images/windows-login.png)

![samba-windows-in](/img/ceritsc/apps/samba-images/windows-in.png)

3. MacOS --- Otevřete Safari a zadejte URL ve formátu `smb://[namespace]-[samba_name].dyn.cloud.e-infra.cz\data`; část `\data` je nezbytná!  Klikněte na `Povolit`, zadejte přihlašovací údaje jako registrovaný uživatel (uživatelské jméno je user, heslo je to, které jste nastavili). Připojte se a síťový disk bude dostupný ve Finderu. Disk můžete později odpojit pomocí tlačítka pro odpojení. 

![samba-mac-allow](/img/ceritsc/apps/samba-images/mac-allow.png)

![samba-mac-connect](/img/ceritsc/apps/samba-images/mac-connect.png)

![samba-mac-unmount](/img/ceritsc/apps/samba-images/mac-unmount.png)
