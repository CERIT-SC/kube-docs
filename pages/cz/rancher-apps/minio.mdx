# Minio

## Spuštění osobního serveru Minio

Pokud nejste přihlášeni, přihlaste se na [rancher.cloud.e-infra.cz](https://rancher.cloud.e-infra.cz), viz sekce [Rancher](../rancher/rancher).

Následováním níže uvedených kroků můžete spustit osobní aplikaci serveru Minio. Tato aplikace je určena k vystavení nebo nahrání dat do jiné běžící aplikace, která používá persistentní objemovou žádost. Přenos dat lze provádět prostřednictvím webového rozhraní -- pomocí pouze webového prohlížeče nebo prostřednictvím protokolu [S3](https://en.wikipedia.org/wiki/Amazon_S3) (to není spojeno s Amazon AWS, je to pouze jejich protokol pro přístup k našim datům).

### Poznámky

* Důležitá podmínka: aplikační pod musí používat [PVC](../kubernetes/pvc), aby server Minio mohl přistupovat k datům z podu. Pokud není použito PVC, není možný přístup k datům.
* U většiny aplikací zde je možné vybrat *persistent home*, což znamená použití *PVC*.

### Zkontrolujte svou aplikaci

Vyberte svůj `Namespace` (1) (nezapomeňte si tento `Namespace`, musíte vybrat **stejný** `Namespace` při instalaci Minio níže), přejděte na `Workload` (2), `Pods` (3) a název aplikace (4), např. `ansys-0` -- klikněte na název. Viz snímek obrazovky níže.

![findpod](/img/ceritsc/apps/minio/findpod.png)

Klikněte na vertikální tečky (1) a vyberte Spustit shell (2).

![enterpod](/img/ceritsc/apps/minio/enterpod.png)

Zadejte příkaz `df` v novém *terminálovém okně* (1) a zkontrolujte, zda vidíte nějaký vzdálený souborový systém připojený k domovu (2) nebo někde jinde.

![inpod](/img/ceritsc/apps/minio/inpod.png)

### Vyberte aplikaci k běhu

Ujistěte se, že jste nevybrali žádný namespace a vidíte `Only User Namespaces` (1) v horní části stránky Rancher.

Přejděte na `App & Marketplace` (2), `Charts` (3), omezte grafy pouze na `cerit-sc` (4) a vyberte `ownCloud` (5). Viz snímek obrazovky níže.

![selectapp](/img/ceritsc/apps/minio/selectapp.png)

### Vyberte verzi aplikace

Když kliknete na graf, stiskněte `Install`, abyste pokračovali.

![selectversion](/img/ceritsc/apps/minio/selectversion.png)

### Nainstalujte aplikaci

Nyní můžete nainstalovat aplikaci Minio. Většinou ponechte jak `Namespace` (1), tak `Name` (2) nedotčené, avšak musíte vybrat stejný `Namespace`, kde běží pod pro přenos dat. `Name` bude v URL pro přístup k aplikaci. `Name` musí být jedinečné v `Namespace`, tj. nemůžete spustit dvě nebo více instancí se stejným `Name` ve stejném `Namespace`.

![appinst](/img/ceritsc/apps/minio/appinst.png)

V první části formuláře nastavíte `uživatelské jméno` a `heslo` pro Minio. Tyto přihlašovací údaje se používají jak pro webový přístup, tak pro přístup S3.

![appform](/img/ceritsc/apps/minio/appform1.png)

Ve druhé části formuláře vyberete PVC (Persistent Volume Claim), tj. persistentní objem, který chcete vystavit nebo nahrát pomocí osobního serveru Minio. Měl by to být existující objem z jiné aplikace, která již běží ve stejném `Namespace` a používá např. *Persistent Home*.

Jakmile vyberete správné PVC, stiskněte `Install`.

![appform](/img/ceritsc/apps/minio/appform2.png)

### Počkejte, až se aplikace spustí

Když stisknete `Install`, uvidíte instalační protokol. Jakmile uvidíte `SUCCESS` (viz snímek obrazovky níže), aplikace běží.

![apphelm](/img/ceritsc/apps/minio/apphelm.png)

Jakmile tato aplikace běží, přejděte na `Service Discovery` (1) a `Ingresses` (2). Uvidíte `Ingresses`. Pokud vidíte `cm-acme-http-solver...` (3), počkejte, až zmizí. Jakmile uvidíte `minio` nebo jakékoli `Name`, které jste použili v předchozích krocích, můžete kliknout na Cíl (4) pro přihlášení do aplikace. Existují dva cíle pro Minio. Jeden Cíl (4) má název začínající názvem aplikace, např. minio. Tento Cíl je pro webový přístup. Druhý Cíl začíná na `s3-` a je určen jako koncový bod S3 API, tj. tato URL je předána [`s3cmd`](https://s3tools.org/s3cmd) nebo [`s4cmd`](https://github.com/bloomreach/s4cmd). `Uživatelské jméno` a `heslo` se nazývají **Access key** a **secret key** pro S3 API a jsou stejné jako pro webový přístup.

![appacme](/img/ceritsc/apps/minio/appacme.png)

Příklad použití `s4cmd` pro výpis dat prostřednictvím S3 API:
```
s4cmd --access-key=$USER --secret-key=$PASSWORD --endpoint-url=https://s3-minio-nextflow-ns.dyn.cerit-sc.cz ls
```
Jednoduše nahraďte `$USER` a `$PASSWORD` a `endpoint-url` svými hodnotami.


## Smazání běžící instance

Pokud máte pocit, že aplikaci již nepotřebujete, můžete ji smazat. Stačí přejít na `App & Marketplace` (1), `Installed Apps` (2), vybrat aplikaci (3) a stisknout `Delete` (4). Data v domovském adresáři nejsou smazána, pokud zkontrolujete persistent home. Opětovným spuštěním aplikace se stejným `Name` obnovíte přístup k adresáři domova.

![appdel](/img/ceritsc/apps/minio/appdel.png)
