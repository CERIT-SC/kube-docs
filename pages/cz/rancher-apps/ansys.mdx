# Ansys

## Spuštění Ansys

Pokud nejste již přihlášeni, přihlaste se na [rancher.cloud.e-infra.cz](https://rancher.cloud.e-infra.cz), viz sekce [Rancher](../rancher/rancher).

Ansys aplikaci můžete spustit podle níže uvedených kroků. Tato aplikace má trvalý domovský adresář, což znamená, že pokud aplikaci odstraníte a později ji znovu nainstalujete pod stejným názvem, obsah domovského adresáře bude zachován. Je také možné připojit nějaké úložiště z e-INFRA CZ.

### Poznámky

* Výchozí projekt měl kvótový limit pro 12 garantovaných CPU a kvótový limit pro 16 CPU. Nevybírejte více než 10 garantovaných CPU a více než 14 CPU limit. Pokud potřebujete více, jednoduše [se zeptejte](mailto:k8s@ics.muni.cz). To může být v budoucnu zvýšeno, takže se můžete ptát na více CPU.

* Pokud v kroku **Nainstalovat aplikaci** nevyberete `Přizpůsobit možnosti Helm před instalací`, instalace se zdá, že selhala, ale ve skutečnosti funguje po nějakém čase.

### Výběr aplikace k spuštění

Ujistěte se, že jste nevybrali žádný prostor jmen a vidíte `Pouze uživatelské prostory jmen` (1) v horní části stránky Rancher.

Procházejte `App & Marketplace` (2), `Charts` (3), omezte grafy pouze na `cerit-sc` (4) a vyberte `Ansys` (5). Viz snímek obrazovky níže.

![selectapp](/img/ceritsc/apps/ansys/selectapp.png)

### Výběr verze aplikace

Když kliknete na graf, můžete vybrat verzi aplikace, jak je znázorněno níže. Vyberte 'Verze grafu', pod 'Verze aplikace' najdete přesnou verzi Ansys. Verze se mohou v průběhu času lišit. Stiskněte `Nainstalovat`, abyste pokračovali.

![selectversion](/img/ceritsc/apps/ansys/selectversion.png)


### Instalace aplikace

Nyní jste připraveni nainstalovat aplikaci Ansys. Většinou necháte jak `Namespace` (1), tak `Name` (2) nedotčené, ale vyberete `Přizpůsobit možnosti Helm před instalací` (3), ale můžete vybrat jakýkoli prostor jmen kromě `default`. Prostor jmen `default` je k dispozici, ale není určen k použití. `Name` se používá v URL pro přístup k aplikaci. `Name` musí být jedinečné v `Namespace`, tj. nemůžete spustit dvě nebo více instancí se stejným `Name` ve stejném `Namespace`. Pokud aplikaci odstraníte a později ji znovu nainstalujete pomocí stejného `Name`, obsah domovského adresáře bude zachován.

![appinst](/img/ceritsc/apps/ansys/appinst.png)

V první části formuláře vyberte metodu zobrazení přístupu. Metoda [VNC]((https://cs.wikipedia.org/wiki/Virtual_Network_Computing) je výchozí. Budete potřebovat program vncview [realvnc](https://www.realvnc.com/en/connect/download/viewer/) nebo `vncviewer` na většině distribucí Linuxu. Na MacOS stačí napsat `vnc://host` v prohlížeči Safari, přičemž `host` nahraďte podle pokynů níže. Nemačkejte `Nainstalovat`, dokud nebude formulář dokončen. Při použití *VNC* je k dispozici pouze softwarové vykreslování, 3D akcelerace není možná.

Pokud není vybráno VNC, bude použita metoda *WEBRTC*. Tato možnost je stále v beta verzi a není připravena pro produkční použití, ale plná 3D OpenGL akcelerace je k dispozici.

![appform1](/img/ceritsc/apps/ansys/appform1.png)

Ve druhé části formuláře vyberete heslo. Toto heslo se používá pro přihlášení k VNC. Pokud není vybráno VNC, musíte také vyplnit `uživatelské jméno`, tyto přihlašovací údaje budou použity v prohlížeči pro připojení k relaci *WEBRTC*.

![appform2](/img/ceritsc/apps/ansys/appform2.png)


Ve třetí části formuláře vyberete, zda chcete trvalý domov, tj. domov, který bude zachován i po odinstalaci aplikace. Poznámka: trvalý domov je vázán na název aplikace od samého začátku instalačního formuláře. To znamená, že pokud nastavíte název na `ansys`, trvalý domov bude vázán na název `ansys`. Pokud příště zvolíte název `ansys-0`, získáte nový domov vázaný na název `ansys-0`.

V této části můžete vybrat úložiště **e-INFRA CZ**, které se připojí k aplikaci. Pokud zaškrtnete `Externí úložiště`, objeví se další možnosti. Můžete vybrat úložiště a přihlašovací údaje. V současnosti je podporováno pouze `storage-brno12-cerit.metacentrum.cz`. Uživatelské jméno je e-infra ([metacentrum](https://metavo.metacentrum.cz/)) přihlášení a heslo **není** heslo Metacentrum, ale jiné nastavené administrátorem, [zeptejte se](mailto:k8s@ics.muni.cz), pokud potřebujete nastavit. Připravujeme pohodlnější způsob. Toto úložiště bude připojeno k adresáři `/storage`.

![appform3](/img/ceritsc/apps/ansys/appform3.png)

Ve čtvrté části formuláře můžete vybrat požadované zdroje. Tento krok je volitelný. Minimální CPU nebo RAM je garantované množství CPU a RAM, systém si tyto zdroje rezervuje pro aplikaci. Aplikace však může překročit garantované zdroje až do `Maximálního`. V tomto případě nejsou zdroje výhradní a mohou být sdíleny s jinými aplikacemi. Pokud aplikace překročí `Maximální` CPU, bude omezena, pokud překročí `Maximální` RAM, bude ukončena (uvidíte zprávu OOMKill) a restartována. Viz poznámka výše o maximálních hodnotách.

![appform4](/img/ceritsc/apps/ansys/appform4.png)


Ve páté části formuláře vyberte časový limit 1200 sekund, což je způsobeno velmi velkými obrázky Ansys. Nakonec stiskněte `Install`.

![appform5](/img/ceritsc/apps/ansys/appform5.png)

### Počkejte na spuštění aplikace

Když stisknete `Install`, uvidíte instalační protokol. Když uvidíte `SUCCESS` (viz snímek obrazovky níže), aplikace běží.

#### Poznámky

* Může trvat nějakou dobu, než bude aplikace připravena, protože stahuje 20GB docker kontejner, pokud již není v mezipaměti, první spuštění může trvat až 20 minut.
* Pokud zadané heslo nebylo správné, bude čekat na neurčito. V tomto případě aplikaci odstraňte a začněte znovu.

![apphelm](/img/ceritsc/apps/ansys/apphelm.png)

### Připojení k běžící instanci

Jakmile aplikace běží, pro verzi *VNC* přejděte na `Service Discovery` (1) a `Services` (2), najeďte myší na `Target` (3) a v závislosti na prohlížeči, který používáte, byste měli vidět cílovou URL (4). Prohlížeč Chrome to zobrazuje v dolním levém rohu. Toto je IP adresa a port, které potřebujete předat své aplikaci `vncviewer` nebo vyplnit do adresního řádku Safari, např. `vnc://147.251.253.246`.

V případě *WEBRTC* místo `Services` přejděte na `Ingresses` (5) a uvidíte úplnou URL, na kterou můžete kliknout pro zahájení *WEBRTC* připojení.

Klient *VNC* se zeptá na heslo. Zadejte heslo z formuláře. Připojení *WEBRTC* se zeptá na uživatelské jméno a heslo, tyto **nejsou** uživatelským jménem a heslem metacentra, ale těmi z počátku formuláře.

![apphelm](/img/ceritsc/apps/ansys/appservice.png)

## Ansys

Při prvním přihlášení bude desktop vypadat takto:
![app](/img/ceritsc/apps/ansys/app.png)

Uvidíte `license checker`, který slouží k ověření dostupných licencí Ansys. Můžete si vybrat, které licence chcete používat. Pokud nejsou k dispozici žádné volné licence, bude kontrolovat pravidelně a pokud bude licence volná, spustí se plynule. Alternativně můžete spustit další části Ansys pomocí ikon na desktopu nebo pomocí terminálu.

Jelikož je Ansys licencovaný produkt, musíte souhlasit s tím, že tento produkt používáte pouze pro akademické účely a že máte právo používat licenci, tj. jste uživatelem MetaCentra.

![legal](/img/ceritsc/apps/ansys/ansys-legal.png)


## Smazat běžící instanci

Pokud se rozhodnete, že aplikaci již nepotřebujete, můžete ji smazat. Stačí přejít na `Apps & Marketplace` (1), `Installed Applications` (2), vybrat aplikaci (3) a stisknout `Delete` (4). Data v domovském adresáři nebudou smazána, pokud vyberete trvalý domov. Opětovné spuštění aplikace se stejným názvem obnoví přístup k domovské složce.

![appdel](/img/ceritsc/apps/ansys/appdel.png)
