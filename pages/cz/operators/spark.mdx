# Spark Operator

[Cílem Spark Operatoru](https://github.com/GoogleCloudPlatform/spark-on-k8s-operator) je usnadnit specifikaci a spuštění Spark aplikací tak, aby to bylo stejně jednoduché a idiomatické jako spuštění jiných pracovních zátěží na Kubernetes. Nasadili jsme Spark Operator na úrovni clusteru, který definuje typy `ScheduledSparkApplication` a `SparkApplication`, úplná dokumentace o struktuře typů je k dispozici [zde](https://github.com/GoogleCloudPlatform/spark-on-k8s-operator/blob/master/docs/api-docs.md). Oficiální a podrobný uživatelský průvodce je k dispozici [zde](https://github.com/GoogleCloudPlatform/spark-on-k8s-operator/blob/master/docs/user-guide.md).

## Důležitá konfigurace
Musíte nastavit `spec.driver.serviceAccount` na `default`, jinak vaše Spark aplikace selže z důvodu problémů s oprávněním. Funkce příkladu Spark používá `hostPath` jako zdroj objemu, ale to nebude fungovat v clusteru, protože hostitelské montáže jsou zakázány. Místo toho použijte `persistentVolumeClaim` ([příklady](https://github.com/GoogleCloudPlatform/spark-on-k8s-operator/blob/master/docs/user-guide.md#mounting-volumes)) a nezapomeňte vytvořit [PVC](../kubernetes/pvc#pvc).

## Další konfigurace

### Spark UI

Spark UI je automaticky vytvořena pro vaše aplikace na HTTPS adrese
```
https://spark-[app_namespace].dyn.cloud.e-infra.cz/[app_namespace]/[app_name]
```
a je také viditelná v uživatelském rozhraní Rancher, postupujte podle kroků, abyste viděli její konečnou podobu. Když zkopírujete adresu do prohlížeče, vynechte poslední skupinu znaků `(/|$)(.*)` (problém související s Rancherem).

![sparkaddress](/img/ceritsc/sparkaddress.png)  

Když přistoupíte na tuto cestu, měli byste být prezentováni s dashboardem podobným

![sparkdashboard](/img/ceritsc/sparkdashboard.png)  

#### Vlastní SparkUI Ingress

Pokud chcete poskytnout vlastní anotace pro Ingress (např. použít jiného vydavatele certifikátů, používáme `letsencrypt`) nebo vlastní TLS tajný klíč, musíte zahrnout následující kódový úryvek do YAML souboru Spark aplikace.

```
  sparkUIOptions:
    ingressAnnotations:
      [annotation_key]: [annotation_value]
      ...
    ingressTLS: (optional section)
      - secretName: [secretname_in_app_namespace]
        hosts:
          - [host]
```

Sloučíme položky poskytnuté vámi s naší konfigurací. Pokud nastavíte stejnou anotaci jako my, vaše hodnota bude propagována.
